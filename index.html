<!DOCTYPE html>
<html lang="zh-CN" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVIDIA BLACKWELL STYLE ARCHITECTURE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        mono: ['JetBrains Mono', 'monospace'],
                        sans: ['Noto Sans SC', 'Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&family=JetBrains+Mono:wght@200;400;700;800&family=Noto+Sans+SC:wght@300;400;700;900&display=swap"
        rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Noto Sans SC', 'JetBrains Mono', monospace;
            user-select: none;
            -webkit-font-smoothing: antialiased;
            cursor: default;
        }

        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
            outline: none;
        }

        /* Scanlines and Noise for industrial monitor look */
        .crt-scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.1) 50%, rgba(0, 0, 0, 0.1));
            background-size: 100% 4px;
            z-index: 30;
            pointer-events: none;
        }

        .noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            opacity: 0.05;
            pointer-events: none;
            z-index: 20;
        }

        /* Branding Overlay */
        #brand-overlay {
            position: fixed;
            top: 3rem;
            left: 3rem;
            z-index: 100;
            pointer-events: none;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.8);
        }

        .gold-text {
            color: #d4af37;
        }

        /* Initial State Styling for UI Panel */
        #ui-panel {
            position: fixed;
            top: 3rem;
            right: 3rem;
            z-index: 100;
            width: 420px;
            background: rgba(5, 5, 8, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            padding: 2rem;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.9);
            transform: translateX(0);
            opacity: 1;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            pointer-events: auto;
            /* Allow clicks even in default state */
        }

        /* Glitch effect on hover */
        .glitch-bar {
            height: 2px;
            width: 0%;
            background: var(--theme-color, #fff);
            box-shadow: 0 0 10px var(--theme-color, #fff);
            transition: width 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        #ui-panel.active .glitch-bar {
            width: 100%;
        }

        /* Crosshair in center */
        .center-crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 40px;
            height: 40px;
            transform: translate(-50%, -50%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            pointer-events: none;
            z-index: 10;
        }

        .center-crosshair::before,
        .center-crosshair::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.2);
        }

        .center-crosshair::before {
            top: 50%;
            left: -10px;
            right: -10px;
            height: 1px;
            transform: translateY(-50%);
        }

        .center-crosshair::after {
            left: 50%;
            top: -10px;
            bottom: -10px;
            width: 1px;
            transform: translateX(-50%);
        }
    </style>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
        }
    }
    </script>
</head>

<body>
    <div class="noise"></div>
    <div class="crt-scanlines"></div>
    <div class="center-crosshair"></div>

    <!-- Branding -->
    <div id="brand-overlay" class="pointer-events-none">
        <h1 class="text-3xl md:text-3xl font-black tracking-tight text-white mb-2 font-sans">
            深空<span class="gold-text">架构</span> // 神经元导航矩阵
        </h1>
        <div class="flex items-center gap-3 text-xs tracking-[0.1em] text-white/50 font-mono">
            <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse shadow-[0_0_8px_#22c55e]"></span>
            全域算力引擎在线 / 请选择需要接入的张量网络
        </div>
    </div>

    <!-- Main Navigation List (Left Sidebar) -->
    <div id="nav-list" class="fixed left-12 top-40 z-50 flex flex-col gap-3 w-80 pointer-events-auto">
        <!-- Dynamically rendered by JS -->
    </div>

    <!-- Hover Diagnostics Panel -->
    <div id="ui-panel">
        <div class="flex items-center gap-3 mb-4">
            <div id="node-led" class="w-3 h-3 rounded-sm shadow-lg animate-pulse bg-white"></div>
            <div id="node-id" class="text-xs font-bold tracking-[0.2em] text-white/50">SYS_IDLE</div>
        </div>

        <h2 id="node-title" class="text-3xl font-black font-sans tracking-tight text-white mb-3 uppercase">全域系统就绪</h2>

        <p id="node-desc" class="text-sm font-sans font-light text-white/70 leading-relaxed mb-8">
            通过鼠标悬停于中心 3D 芯片的各个物理模块结构（如中央处理核心、边缘显存堆叠栈），来唤起并接通对应的神经网络空间。
        </p>

        <div class="w-full bg-white/5 h-[2px] mb-2 overflow-hidden">
            <div id="node-bar" class="glitch-bar"></div>
        </div>

        <div class="flex justify-between text-[10px] text-white/40 tracking-widest mb-6">
            <span id="node-alloc">架构系统状态</span>
            <span id="node-peak" class="font-mono">AWAITING INPUT...</span>
        </div>

        <button id="connect-btn"
            class="w-full py-4 bg-white/5 border border-white/20 hover:bg-white hover:text-black transition-all duration-300 text-sm font-bold tracking-[0.1em] text-center font-sans opacity-50 cursor-not-allowed shadow-lg text-white">
            未探测到目标链路
        </button>
    </div>

    <!-- 3D Canvas Container -->
    <div id="canvas-container"></div>

    <script type="module">
        // Using standard rock-solid WebGL Render pipeline for maximum compatibility and visual fidelity
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js';

        // --- Data Definitions ---
        const nodesData = {
            'hub': { id: "00 主控核心 [NV-ROUTING]", title: "WebNav Hub", desc: "主板视频算力中枢。强制分配芯片内高速流处理器，负责极高并发带宽媒体的转码与流出汇聚。", url: "https://pornavp.onrender.com", color: "#00f0ff" },
            'chatgpt': { id: "01 张量单元 [COMPUTE_L]", title: "ChatGPT Core", desc: "语言模型的思维运算芯片分片。唤醒高维张量单元，实时的推演与庞大上下文咀嚼将在此物理区域爆发。", url: "https://chatgpt.com/", color: "#00ffaa" },
            'gemini': { id: "02 张量单元 [COMPUTE_R]", title: "Gemini Sub-System", desc: "多模态共算物理分片核心。能够游刃有余地接纳系统面对视、听、文数据同时涌入时造成的芯片过载与张量电涌。", url: "https://gemini.google.com/", color: "#cc00ff" },
            'google': { id: "03 高速显存 [HBM3E_TOP]", title: "Google Matrix", desc: "连接全球核心数据库的存储桥。外围金属插脚将以极高频率读取外界信息流，构造庞大的全知搜索网络堆栈。", url: "https://www.google.com/", color: "#ff3366" },
            'grok': { id: "04 高速显存 [HBM3E_BOT]", title: "Grok Unsanctioned", desc: "供无修正数据写入的末端显存区。彻底隔离安全对齐机制，接受来自全网一切混沌暴躁信号的强制输入。", url: "https://grok.com/", color: "#ffee00" }
        };

        let camera, scene, renderer, controls;
        let raycaster, mouse;
        const interactiveMeshes = [];
        let hoveredData = null;

        // UI Elements
        const uiPanel = document.getElementById('ui-panel');
        const nodeId = document.getElementById('node-id');
        const nodeTitle = document.getElementById('node-title');
        const nodeDesc = document.getElementById('node-desc');
        const nodeLed = document.getElementById('node-led');
        const connectBtn = document.getElementById('connect-btn');
        const navList = document.getElementById('nav-list');

        init();
        animate();

        function init() {
            const container = document.getElementById('canvas-container');

            // --- 0. Build Navigation Sidebar ---
            Object.values(nodesData).forEach(data => {
                const btn = document.createElement('a');
                btn.href = data.url;
                btn.target = "_blank";
                btn.setAttribute("data-node-id", data.id);
                // Glassmorphism Button Layout
                btn.className = "group relative overflow-hidden bg-[#0A0A0C]/80 border border-white/5 hover:border-white/20 hover:bg-[#151518]/90 backdrop-blur-md px-5 py-4 flex flex-col transition-all duration-300 transform hover:translate-x-2";

                btn.innerHTML = `
                    <div class="absolute left-0 top-0 bottom-0 w-[3px] bg-white opacity-20 transition-all duration-300 group-hover:opacity-100" style="background-color: ${data.color}"></div>
                    <div class="text-[0.65rem] tracking-[0.2em] font-mono text-white/40 mb-1 transition-colors duration-300" style="--tw-text-opacity:1; group-hover:color:${data.color}">${data.id}</div>
                    <div class="text-base font-bold font-sans text-white/90 group-hover:text-white transition-colors duration-300">${data.title}</div>
                `;

                btn.addEventListener('mouseenter', () => hoveredData = data);
                btn.addEventListener('mouseleave', () => {
                    if (hoveredData === data) {
                        // Check if 3D Raycaster is still actually hovering it before nullifying to prevent flicker
                        hoveredData = null;
                    }
                });

                navList.appendChild(btn);
            });

            // 1. Core Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x030303);
            scene.fog = new THREE.FogExp2(0x030303, 0.003);

            // 2. Camera matches the dramatic top-down isometric hardware photography angle
            camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.set(-80, 110, 120);

            // 3. Renderer with absolute High-End quality
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            container.appendChild(renderer.domElement);

            // 4. Environment Map for Photorealistic Metals
            const pmremGenerator = new THREE.PMREMGenerator(renderer);
            scene.environment = pmremGenerator.fromScene(new RoomEnvironment(), 0.04).texture;

            // 5. Controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.maxPolarAngle = Math.PI / 2.2;
            controls.minDistance = 50;
            controls.maxDistance = 250;
            controls.target.set(0, 0, 0);

            // 6. Lighting
            const ambient = new THREE.AmbientLight(0x222222);
            scene.add(ambient);

            const spotLight = new THREE.SpotLight(0xfff0ee, 20000);
            spotLight.position.set(-50, 150, 50);
            spotLight.angle = Math.PI / 4;
            spotLight.penumbra = 0.5;
            scene.add(spotLight);

            const rimLight = new THREE.DirectionalLight(0xaaccff, 2);
            rimLight.position.set(50, 20, -100);
            scene.add(rimLight);

            // 7. Raycaster setup
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Assemble the Hardware
            buildHardwareGeometry();

            // Events
            window.addEventListener('resize', onWindowResize);
            container.addEventListener('mousemove', onMouseMove);
            connectBtn.addEventListener('click', onConnectClick);

            // Allow clicking directly on the 3D chips to navigate
            let downX = 0, downY = 0;
            container.addEventListener('pointerdown', (e) => {
                downX = e.clientX;
                downY = e.clientY;
            });
            container.addEventListener('pointerup', (e) => {
                // If moved less than 5 pixels, consider it a deliberate click and not a camera drag
                if (Math.abs(e.clientX - downX) < 5 && Math.abs(e.clientY - downY) < 5) {
                    onConnectClick();
                }
            });
        }

        // --- PROCEDURAL CANVAS TEXTURE GENERATOR FOR SILICON DIES ---
        function createComputeTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 1024;
            canvas.height = 2048;
            const ctx = canvas.getContext('2d');

            // Base dark silicon blue
            ctx.fillStyle = '#060a10';
            ctx.fillRect(0, 0, 1024, 2048);

            // Dark grid routing channels
            ctx.strokeStyle = '#0d1624';
            ctx.lineWidth = 4;
            for (let i = 0; i < 1024; i += 32) {
                ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, 2048); ctx.stroke();
            }
            for (let j = 0; j < 2048; j += 32) {
                ctx.beginPath(); ctx.moveTo(0, j); ctx.lineTo(1024, j); ctx.stroke();
            }

            // Draw thousands of SM (Streaming Multiprocessor) cores
            for (let x = 32; x < 1024 - 32; x += 64) {
                for (let y = 32; y < 2048 - 32; y += 64) {
                    if (Math.random() > 0.15) {
                        // Core Base
                        const lum = Math.floor(15 + Math.random() * 20);
                        ctx.fillStyle = `rgb(10, ${lum}, ${lum + 15})`;
                        ctx.fillRect(x + 6, y + 6, 52, 52);

                        // Micro-circuit logic units inside core
                        ctx.fillStyle = `rgb(15, ${lum + 20}, ${lum + 30})`;
                        ctx.fillRect(x + 14, y + 14, 14, 14);
                        ctx.fillRect(x + 36, y + 14, 14, 14);
                        ctx.fillRect(x + 14, y + 36, 14, 14);
                        ctx.fillRect(x + 36, y + 36, 14, 14);
                    }
                }
            }

            const tex = new THREE.CanvasTexture(canvas);
            tex.anisotropy = renderer.capabilities.getMaxAnisotropy();
            return tex;
        }

        function buildHardwareGeometry() {
            // Reference Image Matched Materials
            const goldMat = new THREE.MeshStandardMaterial({ color: 0xe6b85c, metalness: 1.0, roughness: 0.25 });
            const substrateMat = new THREE.MeshStandardMaterial({ color: 0x111111, metalness: 0.3, roughness: 0.8 });
            const interposerMat = new THREE.MeshStandardMaterial({ color: 0x222324, metalness: 0.6, roughness: 0.5 });

            // Photoreal Silicon for dies (uses clearcoat & iridescence)
            const computeMat = new THREE.MeshPhysicalMaterial({
                map: createComputeTexture(),
                color: 0xaaaaaa, metalness: 0.7, roughness: 0.3,
                clearcoat: 1.0, clearcoatRoughness: 0.1,
                iridescence: 1.0, iridescenceIOR: 1.3
            });

            // Golden bronze memory
            const hbmMat = new THREE.MeshStandardMaterial({ color: 0xc49b4f, metalness: 0.9, roughness: 0.35 });

            const chipGrp = new THREE.Group();
            scene.add(chipGrp);

            // 1. Massive Outer Gold Frame (100x100 bounds)
            const frameThickness = 4;
            const size = 100;

            const f1 = new THREE.Mesh(new THREE.BoxGeometry(size, 2, frameThickness), goldMat);
            f1.position.set(0, 1, (size - frameThickness) / 2);
            chipGrp.add(f1);

            const f2 = new THREE.Mesh(new THREE.BoxGeometry(size, 2, frameThickness), goldMat);
            f2.position.set(0, 1, -(size - frameThickness) / 2);
            chipGrp.add(f2);

            const f3 = new THREE.Mesh(new THREE.BoxGeometry(frameThickness, 2, size - frameThickness * 2), goldMat);
            f3.position.set((size - frameThickness) / 2, 1, 0);
            chipGrp.add(f3);

            const f4 = new THREE.Mesh(new THREE.BoxGeometry(frameThickness, 2, size - frameThickness * 2), goldMat);
            f4.position.set(-(size - frameThickness) / 2, 1, 0);
            chipGrp.add(f4);

            // 2. Black Substrate Layer
            const subMesh = new THREE.Mesh(new THREE.BoxGeometry(size - frameThickness * 2, 1.0, size - frameThickness * 2), substrateMat);
            subMesh.position.y = 0.5;
            chipGrp.add(subMesh);

            // 3. Central Interposer
            const interposer = new THREE.Mesh(new THREE.BoxGeometry(80, 0.4, 70), interposerMat);
            interposer.position.y = 1.2;
            chipGrp.add(interposer);

            // --- INTERACTIVE CORE NODES ---

            // 4. Compute Dies (Center Left & Right)
            const lDie = new THREE.Mesh(new THREE.BoxGeometry(26, 0.5, 40), computeMat.clone());
            lDie.position.set(-14, 1.45, 0);
            lDie.userData = nodesData['chatgpt'];
            chipGrp.add(lDie);
            interactiveMeshes.push(lDie);

            const rDie = new THREE.Mesh(new THREE.BoxGeometry(26, 0.5, 40), computeMat.clone());
            rDie.position.set(14, 1.45, 0);
            rDie.userData = nodesData['gemini'];
            chipGrp.add(rDie);
            interactiveMeshes.push(rDie);

            // 5. NVLink Router Bridge (Center Top Bar)
            const bridgeGeo = new THREE.BoxGeometry(8, 0.6, 44);
            const bridgeMat = new THREE.MeshStandardMaterial({ color: 0x333333, metalness: 0.8, roughness: 0.3 });
            const bridge = new THREE.Mesh(bridgeGeo, bridgeMat);
            bridge.position.set(0, 1.6, 0);
            bridge.userData = nodesData['hub'];
            chipGrp.add(bridge);
            interactiveMeshes.push(bridge);

            // 6. HBM3E Stacks (Top & Bottom Flanks)
            // Top HBMs (Google)
            for (let i = 0; i < 4; i++) {
                const hbm = new THREE.Mesh(new THREE.BoxGeometry(14, 0.4, 10), hbmMat.clone());
                hbm.position.set(-23 + i * 15.3, 1.4, -28);
                // Assign identical object reference so they light up as a group
                hbm.userData = nodesData['google'];
                chipGrp.add(hbm);
                interactiveMeshes.push(hbm);
            }

            // Bottom HBMs (Grok)
            for (let i = 0; i < 4; i++) {
                const hbm = new THREE.Mesh(new THREE.BoxGeometry(14, 0.4, 10), hbmMat.clone());
                hbm.position.set(-23 + i * 15.3, 1.4, 28);
                hbm.userData = nodesData['grok'];
                chipGrp.add(hbm);
                interactiveMeshes.push(hbm);
            }
        }

        // --- INTERACTION LOGIC ---
        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        function onConnectClick() {
            if (hoveredData && hoveredData.url) {
                window.open(hoveredData.url, '_blank');
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function updateUIPanel(data) {
            if (!data) {
                // Restore default idle UI state
                uiPanel.classList.remove('active');
                document.body.classList.remove('cursor-pointer');
                nodeId.textContent = "SYS_IDLE";
                nodeTitle.textContent = "全域系统就绪";
                uiPanel.style.setProperty('--theme-color', "#ffffff");
                nodeLed.style.backgroundColor = "#ffffff";
                nodeLed.style.boxShadow = `0 0 15px rgba(255,255,255,0.5)`;
                nodeDesc.textContent = "通过悬停于中心 3D 芯片的各个物理模块结构（如大中央核心、边缘显存区），探测并建立至对应的神经网络分部。";

                document.getElementById('node-alloc').textContent = "架构系统状态";
                document.getElementById('node-peak').textContent = "AWAITING INPUT...";

                connectBtn.textContent = "未发现活动链路";
                connectBtn.classList.add('opacity-50', 'cursor-not-allowed');
                connectBtn.classList.remove('hover:bg-white', 'hover:text-black');
                return;
            }

            uiPanel.classList.add('active');
            document.body.classList.add('cursor-pointer');

            nodeId.textContent = data.id;
            nodeTitle.textContent = data.title;
            uiPanel.style.setProperty('--theme-color', data.color);
            nodeLed.style.backgroundColor = data.color;
            nodeLed.style.boxShadow = `0 0 15px ${data.color}`;
            nodeDesc.textContent = data.desc;

            document.getElementById('node-alloc').textContent = "当前流转带宽";
            document.getElementById('node-peak').textContent = "100% 满血峰值";

            connectBtn.textContent = "已就绪：点击左侧神经元接通 →";
            connectBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            connectBtn.classList.add('hover:bg-white', 'hover:text-black');
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();

            const time = performance.now() * 0.005;

            // Handle Raycasting
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactiveMeshes);

            let newHoverData = null;
            if (intersects.length > 0) {
                newHoverData = intersects[0].object.userData;
            }

            if (newHoverData !== hoveredData) {
                hoveredData = newHoverData;
                updateUIPanel(hoveredData);
            }

            // Update Emissive colors on all meshes
            interactiveMeshes.forEach(mesh => {
                const dt = mesh.userData;
                if (hoveredData && dt === hoveredData) {
                    // Activate this group
                    mesh.material.emissive.set(dt.color);
                    mesh.material.emissiveIntensity = (Math.sin(time) + 1.0) * 0.6 + 0.2;
                } else {
                    // Idle state
                    mesh.material.emissive.setHex(0x000000);
                }
            });

            renderer.render(scene, camera);
        }
    </script>
</body>

</html>